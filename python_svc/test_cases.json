{
  "metadata": {
    "generated_at": "2026-01-31 16:15:03",
    "pipeline_name": "Customer Data SCD Type 2 ETL",
    "source_report": "etl_analysis_report.md",
    "total_cases": 20,
    "quality_checks": 12,
    "scenario_checks": 8
  },
  "test_cases": [
    {
      "test_id": "QC001",
      "test_name": "Check Total Records Loaded",
      "test_description": "Validate that all records from the source CSV are loaded into the target table.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(*) FROM dim_customer;",
      "expected_result": 7,
      "severity": "critical"
    },
    {
      "test_id": "QC002",
      "test_name": "Check Unique Customer IDs",
      "test_description": "Validate that all customer_ids in the target table are unique.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(customer_id) FROM dim_customer GROUP BY customer_id HAVING COUNT(*) > 1;",
      "expected_result": 0,
      "severity": "critical"
    },
    {
      "test_id": "QC003",
      "test_name": "Check Required Fields for NULL Values",
      "test_description": "Validate that required fields (customer_id, effective_start_date, is_current) are not NULL.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(*) FROM dim_customer WHERE customer_id IS NULL OR effective_start_date IS NULL OR is_current IS NULL;",
      "expected_result": 0,
      "severity": "high"
    },
    {
      "test_id": "QC004",
      "test_name": "Check Current Records per Customer",
      "test_description": "Ensure there is only one current record (is_current = true) per customer_id.",
      "test_type": "quality_check",
      "sql_query": "SELECT customer_id, COUNT(*) FROM dim_customer WHERE is_current = true GROUP BY customer_id HAVING COUNT(*) > 1;",
      "expected_result": 0,
      "severity": "critical"
    },
    {
      "test_id": "QC005",
      "test_name": "Check Effective End Date for Current Records",
      "test_description": "Validate that current records (is_current = true) have a NULL effective_end_date.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(*) FROM dim_customer WHERE is_current = true AND effective_end_date IS NOT NULL;",
      "expected_result": 0,
      "severity": "high"
    },
    {
      "test_id": "QC006",
      "test_name": "Check Effective Start and End Dates",
      "test_description": "Validate that effective_end_date is greater than effective_start_date for all records.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(*) FROM dim_customer WHERE effective_end_date IS NOT NULL AND effective_end_date <= effective_start_date;",
      "expected_result": 0,
      "severity": "high"
    },
    {
      "test_id": "QC007",
      "test_name": "Check Data Types of Columns",
      "test_description": "Validate that the data types of the columns match the expected types.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(*) FROM dim_customer WHERE NOT (surrogate_key IS NOT NULL AND customer_id IS NOT NULL AND first_name IS NULL AND last_name IS NULL AND email IS NULL AND company_name IS NULL AND phone IS NULL AND effective_start_date IS NOT NULL AND (effective_end_date IS NULL OR effective_end_date > effective_start_date) AND is_current IS NOT NULL);",
      "expected_result": 0,
      "severity": "medium"
    },
    {
      "test_id": "QC008",
      "test_name": "Check Email Format",
      "test_description": "Validate that all email addresses conform to a standard format.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(*) FROM dim_customer WHERE email !~ '^[^@]+@[^@]+\\.[^@]+$';",
      "expected_result": 0,
      "severity": "medium"
    },
    {
      "test_id": "QC009",
      "test_name": "Check Phone Number Format",
      "test_description": "Validate that all phone numbers conform to a standard format.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(*) FROM dim_customer WHERE phone !~ '^\\d{3}-\\d{4}$';",
      "expected_result": 0,
      "severity": "medium"
    },
    {
      "test_id": "QC010",
      "test_name": "Check for Duplicate Surrogate Keys",
      "test_description": "Validate that surrogate_keys are unique in the target table.",
      "test_type": "quality_check",
      "sql_query": "SELECT surrogate_key, COUNT(*) FROM dim_customer GROUP BY surrogate_key HAVING COUNT(*) > 1;",
      "expected_result": 0,
      "severity": "critical"
    },
    {
      "test_id": "QC011",
      "test_name": "Check Created At and Updated At Timestamps",
      "test_description": "Validate that updated_at is greater than or equal to created_at for all records.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(*) FROM dim_customer WHERE updated_at < created_at;",
      "expected_result": 0,
      "severity": "medium"
    },
    {
      "test_id": "QC012",
      "test_name": "Check Company Name Consistency",
      "test_description": "Validate that company names are not empty or NULL.",
      "test_type": "quality_check",
      "sql_query": "SELECT COUNT(*) FROM dim_customer WHERE company_name IS NULL OR company_name = '';",
      "expected_result": 0,
      "severity": "medium"
    },
    {
      "test_id": "SC001",
      "test_name": "New Customer Insertion",
      "test_description": "Tests the insertion of a new customer into the target database.",
      "test_type": "scenario_check",
      "input_data": [
        {
          "customer_id": "C006",
          "first_name": "Alice",
          "last_name": "Johnson",
          "email": "alice.johnson@email.com",
          "company_name": "NewWave Corp",
          "phone": "555-0106"
        }
      ],
      "expected_outcome": "A new record for customer C006 is inserted into dim_customer with is_current set to true.",
      "validation_queries": [
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C006' AND is_current = true;"
      ],
      "severity": "high"
    },
    {
      "test_id": "SC002",
      "test_name": "Company Name Change (SCD Type 2)",
      "test_description": "Tests the change of company name for an existing customer using SCD Type 2.",
      "test_type": "scenario_check",
      "input_data": [
        {
          "customer_id": "C001",
          "first_name": "John",
          "last_name": "Doe",
          "email": "john.doe@email.com",
          "company_name": "NewTech Industries",
          "phone": "555-0101"
        }
      ],
      "expected_outcome": "A new record for customer C001 is created with the new company name, and the previous record's is_current is set to false.",
      "validation_queries": [
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C001' AND is_current = true;",
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C001' AND is_current = false;"
      ],
      "severity": "high"
    },
    {
      "test_id": "SC003",
      "test_name": "Name/Email/Phone Change (SCD Type 1)",
      "test_description": "Tests the change of name, email, and phone for an existing customer using SCD Type 1.",
      "test_type": "scenario_check",
      "input_data": [
        {
          "customer_id": "C002",
          "first_name": "Jane",
          "last_name": "Doe",
          "email": "jane.doe@email.com",
          "company_name": "MegaData Corp",
          "phone": "555-0102"
        }
      ],
      "expected_outcome": "The existing record for customer C002 is updated with the new first name, last name, and email.",
      "validation_queries": [
        "SELECT first_name, last_name, email FROM dim_customer WHERE customer_id = 'C002';"
      ],
      "severity": "medium"
    },
    {
      "test_id": "SC004",
      "test_name": "Combined Type 1 + Type 2 Changes",
      "test_description": "Tests the simultaneous change of company name (SCD Type 2) and name/email change (SCD Type 1).",
      "test_type": "scenario_check",
      "input_data": [
        {
          "customer_id": "C003",
          "first_name": "Michael",
          "last_name": "Smith",
          "email": "michael.smith@email.com",
          "company_name": "CloudBase Systems",
          "phone": "555-0103"
        }
      ],
      "expected_outcome": "A new record for customer C003 is created with the new company name, and the previous record's is_current is set to false. The name and email are updated in the new record.",
      "validation_queries": [
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C003' AND is_current = true;",
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C003' AND is_current = false;"
      ],
      "severity": "high"
    },
    {
      "test_id": "SC005",
      "test_name": "Multiple Sequential Changes to Same Customer",
      "test_description": "Tests multiple updates to the same customer in sequential runs.",
      "test_type": "scenario_check",
      "input_data": [
        {
          "customer_id": "C001",
          "first_name": "John",
          "last_name": "Doe",
          "email": "john.doe@email.com",
          "company_name": "TechCorp Inc",
          "phone": "555-0101"
        },
        {
          "customer_id": "C001",
          "first_name": "John",
          "last_name": "Doe",
          "email": "john.doe@email.com",
          "company_name": "NeoTech Industries",
          "phone": "555-0101"
        }
      ],
      "expected_outcome": "Two records for customer C001 are created: the first with TechCorp Inc and the second with NeoTech Industries, with the first marked as not current.",
      "validation_queries": [
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C001' AND is_current = true;",
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C001' AND is_current = false;"
      ],
      "severity": "high"
    },
    {
      "test_id": "SC006",
      "test_name": "Unchanged Records (No Updates)",
      "test_description": "Tests that unchanged records do not trigger any updates in the ETL process.",
      "test_type": "scenario_check",
      "input_data": [
        {
          "customer_id": "C003",
          "first_name": "Michael",
          "last_name": "Johnson",
          "email": "michael.j@email.com",
          "company_name": "CloudBase Systems",
          "phone": "555-0103"
        }
      ],
      "expected_outcome": "The record for customer C003 remains unchanged, and no new records are created.",
      "validation_queries": [
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C003';"
      ],
      "severity": "medium"
    },
    {
      "test_id": "SC007",
      "test_name": "New Customer + Existing Customer Updates in Same File",
      "test_description": "Tests the scenario where a new customer is added alongside updates to existing customers.",
      "test_type": "scenario_check",
      "input_data": [
        {
          "customer_id": "C007",
          "first_name": "Alice",
          "last_name": "Brown",
          "email": "alice.brown@email.com",
          "company_name": "FutureTech",
          "phone": "555-0107"
        },
        {
          "customer_id": "C002",
          "first_name": "Jane",
          "last_name": "Doe",
          "email": "jane.doe@email.com",
          "company_name": "MegaData Corp",
          "phone": "555-0102"
        }
      ],
      "expected_outcome": "A new record for customer C007 is created, and the existing record for C002 is updated with the new name.",
      "validation_queries": [
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C007';",
        "SELECT first_name, last_name FROM dim_customer WHERE customer_id = 'C002';"
      ],
      "severity": "high"
    },
    {
      "test_id": "SC008",
      "test_name": "Edge Cases (Empty Values, Special Characters)",
      "test_description": "Tests the handling of edge cases including empty values and special characters.",
      "test_type": "scenario_check",
      "input_data": [
        {
          "customer_id": "C008",
          "first_name": "",
          "last_name": "O'Reilly",
          "email": "o'reilly@email.com",
          "company_name": "EdgeCase Inc",
          "phone": "555-0108"
        }
      ],
      "expected_outcome": "A new record for customer C008 is created with the first name as empty and the last name containing a special character.",
      "validation_queries": [
        "SELECT COUNT(*) FROM dim_customer WHERE customer_id = 'C008';",
        "SELECT first_name, last_name FROM dim_customer WHERE customer_id = 'C008';"
      ],
      "severity": "medium"
    }
  ]
}